
<!DOCTYPE html>
<html lang="en-gb">
    <head>
        <meta charset="UTF-8">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="keep your secrets... secret">
        <meta name="author" content="VMware Secrets Manager Contributors">
        <title>Mounting Secrets as Volumes | VMware Secrets Manager </title>
        <link rel="stylesheet" href="https://vsecm.com/site.css"/>
        <link rel="icon" href="https://vsecm.com/vsecm-32.png">
    </head>
    <body>

        <header style="background:#00151D;">
            <nav class="">
                <a class="header__logo white" href="https:&#x2F;&#x2F;vsecm.com&#x2F;" style="font-weight:100;color:#95e3fc;">
                    <img src="https://vsecm.com/vsecm-64.png" alt="VSecM" style="vertical-align:middle">
                    VMware Secrets Manager
                    <em style="font-size:0.62em;color:#ffffff">v0.28.0</em>
                </a>
                <a class="white" href="https://vsecm.com/documentation/" class="nav-link">
                <svg
                    style="position:relative;top:4px;"
                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="-0.375 -0.375 24 24" id="Programming-Book--Streamline-Ultimate" height="24" width="24"><desc>Programming Book</desc><path fill="#e3e3e3" d="M18.890625 4.359375v-2.90625a0.96875 0.96875 0 0 0 -0.96875 -0.96875h-12.59375a1.9375 1.9375 0 1 0 0 3.875h13.5625Z" stroke-width="0.75"></path><path fill="#ffef5e" d="M3.390625 2.421875a1.9375 1.9375 0 0 0 1.9375 1.9375h13.5625a0.96875 0.96875 0 0 1 0.96875 0.96875v16.46875a0.96875 0.96875 0 0 1 -0.96875 0.96875h-13.5625a1.9375 1.9375 0 0 1 -1.9375 -1.9375v-18.40625Z" stroke-width="0.75"></path><path fill="#fff9bf" d="M18.890625 4.359375h-13.5625a1.9375 1.9375 0 0 1 -1.9375 -1.9375v2.90625a1.9375 1.9375 0 0 0 1.9375 1.9375h13.5625a0.96875 0.96875 0 0 1 0.96875 0.96875v-2.90625a0.96875 0.96875 0 0 0 -0.96875 -0.96875Z" stroke-width="0.75"></path><path stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="M5.328125 2.421875h10.65625a0.96875 0.96875 0 0 1 0.96875 0.96875v0.96875" stroke-width="0.75"></path><path stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="M18.890625 4.359375v-2.90625a0.96875 0.96875 0 0 0 -0.96875 -0.96875h-12.59375a1.9375 1.9375 0 1 0 0 3.875h13.5625Zm0 0a0.96875 0.96875 0 0 1 0.96875 0.96875v16.46875a0.96875 0.96875 0 0 1 -0.96875 0.96875h-13.5625a1.9375 1.9375 0 0 1 -1.9375 -1.9375v-18.40625" stroke-width="0.75"></path><path stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="m7.265625 10.175749999999999 2.421875 2.421875 -2.421875 2.421875" stroke-width="0.75"></path><path stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="M12.109375 14.050749999999999h3.875" stroke-width="0.75"></path></svg>
                Docs

                </a>
                <a class="white" href=" https://join.slack.com/t/a-101-103-105-s/shared_invite/zt-287dbddk7-GCX495NK~FwO3bh_DAMAtQ" class="nav-link">
                    <svg
                        style="position:relative;top:6px;"
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14" id="Slack-Logo--Streamline-Flex-Gradient" height="24" width="24" stroke-width="1"><desc>Slack Logo</desc><g id="slack"><path id="Union" fill="url(#paint0_linear_7718_2952)" fill-rule="evenodd" d="M5.75879.25c.41421 0 .75.335786.75.75v.24995c0 .41421-.33579.75-.75.75s-.75-.33579-.75-.75V1c0-.414214.33579-.75.75-.75ZM13 4.34033c.4142 0 .75.33579.75.75v.24995c0 .41422-.3358.75-.75.75s-.75-.33578-.75-.75v-.24995c0-.41421.3358-.75.75-.75ZM1.75 8.03479c0-.41421-.33579-.75-.75-.75-.414214 0-.75.33579-.75.75v.24995c0 .41421.335786.75.75.75.41421 0 .75-.33579.75-.75v-.24995Zm4.54094-4.46403c.23744.28178.38454.65583.38454 1.04404 0 .38821-.1471.76227-.38454 1.04404-.23628.2804-.58938.4986-1.01303.50949-1.1742.06477-2.45614.06477-3.63034 0-.42365-.01089-.776743-.22909-1.013025-.50949C.397098 5.37707.25 5.00301.25 4.6148c0-.38821.147099-.76226.384545-1.04404.236282-.28039.589375-.49859 1.013025-.50948 1.1742-.06478 2.45614-.06478 3.63034 0 .42365.01089.77675.22909 1.01303.50948ZM9.34332.25c-.38821 0-.76226.147099-1.04404.384545-.2804.236281-.4986.589375-.50949 1.013025-.06477 1.1742-.06477 2.45614 0 3.63034.01089.42365.22909.77675.50949 1.01303.28178.23744.65583.38454 1.04404.38454.38821 0 .76228-.1471 1.04408-.38454.2804-.23628.4986-.58938.5094-1.01303.0648-1.1742.0648-2.45614 0-3.63034-.0108-.42365-.229-.776743-.5094-1.013025C10.1056.397099 9.73153.25 9.34332.25ZM5.70084 13.3671c-.28178.2375-.65584.3846-1.04405.3846-.3882 0-.76226-.1471-1.04404-.3846-.28039-.2363-.49859-.5894-.50948-1.013-.06478-1.1742-.06478-2.45615 0-3.63036.01089-.42364.22909-.77674.50948-1.01302.28178-.23745.65584-.38455 1.04405-.38455.38821 0 .76226.1471 1.04404.38455.28039.23628.49859.58938.50948 1.01302.06478 1.17421.06478 2.45616 0 3.63036-.01089.4236-.22909.7767-.50948 1.013Zm1.62338-3.9802c0 .38821.1471.7623.38454 1.044.23628.2804.58938.4986 1.01303.5095 1.1742.0648 2.45611.0648 3.63031 0 .4237-.0109.7768-.2291 1.0131-.5095.2374-.2817.3845-.65579.3845-1.044 0-.38821-.1471-.76227-.3845-1.04404-.2363-.2804-.5894-.4986-1.0131-.50949-1.1742-.06477-2.45611-.06477-3.63031 0-.42365.01089-.77674.22909-1.01303.50949-.23744.28177-.38454.65583-.38454 1.04404Zm.85644 2.6148c.41422 0 .75.3358.75.75v.25c0 .4142-.33578.75-.75.75-.41421 0-.75-.3358-.75-.75v-.25c0-.4142.33579-.75.75-.75Z" clip-rule="evenodd"></path></g><defs><linearGradient id="paint0_linear_7718_2952" x1="14.92" x2="-3.291" y1="16.611" y2="3.677" gradientUnits="userSpaceOnUse"><stop stop-color="#ffd600"></stop><stop offset="1" stop-color="#FF007A"></stop></linearGradient></defs></svg>
                    Slack</a>
                <a class="white" href="https://github.com/vmware-tanzu/secrets-manager" class="nav-link">
                    <svg
                        style="position:relative;top:6px;"
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="-0.375 -0.375 24 24" id="Github-Logo--Streamline-Ultimate" height="24" width="24"><desc>Github Logo</desc><path fill="#808080" d="M21.0912375 9.106250000000001L21.1230125 9.129015625000001S23.7510375 4.588096875000001 20.5270375 1.94118125C18.540615625 1.94118125 15.503390625 5.21885 15.503390625 5.21885L15.525284375 5.2347375C13.00004375 4.5066250000000005 10.321353125 4.5012 7.793109374999999 5.21885C7.776253125000001 5.20393125 4.75094375 1.94118125 2.7694625 1.94118125C-0.381978125 4.523578125 2.04541875 8.905621875 2.159634375 9.10915625C1.0598125 10.796428125 0.570884375 12.80939375 0.7741281250000001 14.81315625C1.01350625 17.918 3.6018125 21.30881875 6.715471875 21.30881875H16.533365625000002C19.647121875 21.30881875 22.236396875 17.918 22.474709375 14.81315625C22.680859375 12.808521875 22.192415625 10.793909374999998 21.0912375 9.106250000000001Z" stroke-width="0.75"></path><path fill="#b2b2b2" d="M1.09294375 11.432315625C4.235665625 9.4212875 7.895021874999999 8.366803124999999 11.62596875 8.397028125C15.356915625 8.36554375 19.016659375 9.4189625 22.159865625000002 11.4293125C21.926784375 10.603065625 21.566215625 9.81828125 21.0912375 9.103246875L21.1230125 9.126109375S23.7510375 4.5850937499999995 20.5270375 1.938275C18.540615625 1.938275 15.503390625 5.215846875 15.503390625 5.215846875L15.525284375 5.230765625C12.999656250000001 4.50449375 10.3210625 4.500425 7.793109374999999 5.21885C7.776253125000001 5.20393125 4.75094375 1.94118125 2.7694625 1.94118125C-0.381978125 4.523578125 2.04541875 8.905621875 2.159634375 9.10915625C1.68581875 9.8239 1.3259281250000001 10.60800625 1.09294375 11.433284375Z" stroke-width="0.75"></path><path stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="M21.0912375 9.106250000000001L21.1230125 9.129015625000001S23.7510375 4.588096875000001 20.5270375 1.94118125C18.540615625 1.94118125 15.503390625 5.21885 15.503390625 5.21885L15.525284375 5.2347375C13.00004375 4.5066250000000005 10.321353125 4.5012 7.793109374999999 5.21885C7.776253125000001 5.20393125 4.75094375 1.94118125 2.7694625 1.94118125C-0.381978125 4.523578125 2.04541875 8.905621875 2.159634375 9.10915625C1.0598125 10.796428125 0.570884375 12.80939375 0.7741281250000001 14.81315625C1.01350625 17.918 3.6018125 21.30881875 6.715471875 21.30881875H16.533365625000002C19.647121875 21.30881875 22.236396875 17.918 22.474709375 14.81315625C22.680859375 12.808521875 22.192415625 10.793909374999998 21.0912375 9.106250000000001Z" stroke-width="0.75"></path><path fill="#ffdda1" stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="M19.074978125 15.846134374999998C19.074978125 9.917675000000001 14.976971875 12.338096875 11.62596875 12.338096875C8.27486875 12.338096875 4.1768625 9.9792875 4.1768625 15.846134374999998C4.1768625 17.766003124999997 5.733256249999999 19.322396875 7.653125 19.322396875H15.598812500000001C17.51868125 19.322396875 19.074978125 17.766003124999997 19.074978125 15.846134374999998H19.074978125Z" stroke-width="0.75"></path><path fill="#c77f67" stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="M15.123059375 17.335974999999998C15.671275 17.335974999999998 16.116221875 16.66850625 16.116221875 15.846134374999998S15.671275 14.35629375 15.123059375 14.35629375S14.1298 15.0237625 14.1298 15.846134374999998S14.574746875 17.335974999999998 15.123059375 17.335974999999998Z" stroke-width="0.75"></path><path fill="#c77f67" stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="M8.170534375 17.335974999999998C8.718846875 17.335974999999998 9.16379375 16.66850625 9.16379375 15.846134374999998S8.718846875 14.35629375 8.170534375 14.35629375S7.177371875 15.0237625 7.177371875 15.846134374999998S7.62231875 17.335974999999998 8.170534375 17.335974999999998Z" stroke-width="0.75"></path></svg>
                    GitHub</a>

                <div class="search-container">
                    <input id="search" type="search" placeholder="Search...">

                    <div class="search-results">
                        <div class="search-results__items"></div>
                    </div>
                </div>
            </nav>
        </header>
        <!--div style="background: #cc0000; color: #ffffff; padding: 1em;">
            This is a snapshot of the VMware Secrets Manager documentation
            at version <strong>v0.25.3</strong>.<br>
            For the latest information, please visit the
            <a href="/" style="color:#ffff00;text-decoration:underline;border:0"
            >VMware Secrets Manager documentation root</a>.
        </div-->
            <div style="font-size:1em;background:#FFED90;
            color: #000000;
padding: 1em;
">
                <svg
                    style="display:inline-block;top: 7px;position:relative;"
                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="-0.375 -0.375 24 24" id="Calendar-Favorite-1--Streamline-Ultimate" height="24" width="24"><desc>Calendar Favorite 1 Streamline Icon: https://streamlinehq.com</desc><path fill="#ff808c" d="M19.859375 7.273375V3.390625a0.96875 0.96875 0 0 0 -0.96875 -0.96875h-17.4375a0.96875 0.96875 0 0 0 -0.96875 0.96875v3.88275h19.375Z" stroke-width="0.75"></path><path fill="#ffbfc5" d="M19.859375 4.359375v-0.96875a0.96875 0.96875 0 0 0 -0.96875 -0.96875h-17.4375a0.96875 0.96875 0 0 0 -0.96875 0.96875v0.96875h19.375Z" stroke-width="0.75"></path><path fill="#ffffff" d="M0.484375 7.273375V16.953125a0.96875 0.96875 0 0 0 0.96875 0.96875h17.4375a0.96875 0.96875 0 0 0 0.96875 -0.96875v-9.6875l-19.375 0.00775Z" stroke-width="0.75"></path><path stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="M9.203125 17.921875h-7.75a0.96875 0.96875 0 0 1 -0.96875 -0.96875v-13.5625a0.96875 0.96875 0 0 1 0.96875 -0.96875h17.4375a0.96875 0.96875 0 0 1 0.96875 0.96875V9.6875" stroke-width="0.75"></path><path stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="M5.328125 0.48534375v4.84375" stroke-width="0.75"></path><path stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="M15.015625 0.48534375v4.84375" stroke-width="0.75"></path><path stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="M0.484375 7.26659375h19.375" stroke-width="0.75"></path><path fill="#ffef5e" d="m17.631249999999998 11.554281249999999 1.4909062499999999 3.4584375h2.9004375000000002a0.71203125 0.71203125 0 0 1 0.5018125 1.2429062499999999l-2.5187500000000003 2.2436249999999998 1.395 3.2085a0.76046875 0.76046875 0 0 1 -1.08209375 0.9513125L16.953125 20.7603125l-3.37125 1.89875a0.76046875 0.76046875 0 0 1 -1.08209375 -0.9513125l1.3969375 -3.204625 -2.5187500000000003 -2.2436249999999998a0.71203125 0.71203125 0 0 1 0.49793750000000003 -1.2429062499999999h2.90625l1.491875 -3.4584375a0.775 0.775 0 0 1 1.3659375 0l-0.0096875 -0.003875Z" stroke-width="0.75"></path><path fill="#fff9bf" d="M19.127 15.015625 17.631249999999998 11.554281249999999a0.775 0.775 0 0 0 -1.36496875 0L14.778281250000001 15.015625h-2.90625a0.71203125 0.71203125 0 0 0 -0.49793750000000003 1.2429062499999999l2.5187500000000003 2.24265625 -1.3920937500000001 3.2085a0.755625 0.755625 0 0 0 -0.0096875 0.5366875000000001l7.2365625 -7.2307500000000005h-0.600625Z" stroke-width="0.75"></path><path stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="m17.631249999999998 11.554281249999999 1.4909062499999999 3.4584375h2.9004375000000002a0.71203125 0.71203125 0 0 1 0.5018125 1.2429062499999999l-2.5187500000000003 2.2436249999999998 1.395 3.2085a0.76046875 0.76046875 0 0 1 -1.08209375 0.9513125L16.953125 20.7603125l-3.37125 1.89875a0.76046875 0.76046875 0 0 1 -1.08209375 -0.9513125l1.3969375 -3.204625 -2.5187500000000003 -2.2436249999999998a0.71203125 0.71203125 0 0 1 0.49793750000000003 -1.2429062499999999h2.90625l1.491875 -3.4584375a0.775 0.775 0 0 1 1.3659375 0l-0.0096875 -0.003875Z" stroke-width="0.75"></path></svg>
                &nbsp;<a style="color: #00151D" href="/community/contributor-hours/"><strong>Mark Your Calendars</strong></a>:
                The next
                <strong
                ><a
                    style="color: #FFE9BA;background: #08011C;padding: 0.2em;font-weight:400;margin:0.4em;position:relative;display:inline-block;transform: rotate(-2deg)"
                    href="/community/contributor-hours/"
                >VSecM Contributor Sync</a
                ></strong
                >
                will be on...
                <a
                    href="/community/contributor-hours/"
                    style="color: #FFE9BA;background: #08011C;padding: 0.2em;margin:0.4em;font-weight:400;position:relative;display:inline-block;transform: rotate(-2deg)"

                >üéÉ Thursday, 2024-10-31 üéÉ
                at 8:00am Pacific time</a>.

            </div>
        <div
        style="padding:1em;background:#DDC755;color:#000000"
        >
            <svg
                style="position:relative;top:6px;"
                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="-0.375 -0.375 24 24" id="Rating-Star-1--Streamline-Ultimate" height="24" width="24"><desc>Rating Star 1 Streamline Icon: https://streamlinehq.com</desc><path fill="#ffef5e" d="M10.936896875 1.971503125C11.000059375000001 1.840915625 11.098871874999999 1.73076875 11.221903125 1.6537531250000002C11.34464375 1.5767375 11.486953125 1.53585625 11.631974999999999 1.53585625C11.776996875 1.53585625 11.919209375 1.5767375 12.042046875 1.6537531250000002C12.16498125 1.73076875 12.263890625 1.840915625 12.327053125 1.971503125L15.183025 7.745253125L21.583846875000003 8.671959375C21.726737500000002 8.692690625000001 21.860812499999998 8.75304375 21.97105625 8.8462375C22.081396875000003 8.939334375 22.163353125 9.061396875 22.207721875 9.198862499999999C22.252187499999998 9.336134375 22.257128125 9.483190624999999 22.222253124999998 9.623175C22.187378125 9.763256250000001 22.113850000000003 9.890646875 22.01019375 9.99110625L17.376371875 14.4704125L18.469896875 20.803325C18.494309375 20.945149999999998 18.478615625 21.090946875 18.424462499999997 21.22434375C18.370406250000002 21.35764375 18.28011875 21.473409375 18.163771875000002 21.558175C18.047618749999998 21.642940625 17.9098625 21.693509375 17.766390625 21.7042625C17.622821875 21.714918750000002 17.479253125 21.685468750000002 17.351571875 21.618915625L11.630424999999999 18.63158125L5.89833125 21.62656875C5.770746875 21.69321875 5.62708125 21.72266875 5.4836093749999995 21.7120125C5.3401375 21.701259375 5.202478125000001 21.650690625 5.08613125 21.565925C4.96988125 21.481159375 4.87959375 21.36539375 4.8255375 21.23209375C4.77148125 21.098696874999998 4.755690625 20.9529 4.780103125 20.811075L5.873725 14.4781625L1.23980625 9.998856250000001C1.13615 9.898396875000001 1.06271875 9.77100625 1.027746875 9.630925C0.992871875 9.490940625 0.9978125 9.343884375 1.04218125 9.2066125C1.086646875 9.069146875000001 1.168603125 8.947084375 1.2788468750000002 8.8539875C1.3891875 8.76079375 1.523359375 8.700440624999999 1.666153125 8.679709375L8.068525 7.753003125L10.936896875 1.971503125Z" stroke-width="0.75"></path><path fill="#fff9bf" d="M11.630424999999999 18.63158125L5.89833125 21.62656875C5.770746875 21.69321875 5.62708125 21.72266875 5.4836093749999995 21.7120125C5.3401375 21.701259375 5.202478125000001 21.650690625 5.08613125 21.565925C4.96988125 21.481159375 4.87959375 21.36539375 4.8255375 21.23209375C4.77148125 21.098696874999998 4.755690625 20.9529 4.780103125 20.811075L5.873725 14.4781625L1.23980625 9.998856250000001C1.13615 9.898396875000001 1.06271875 9.77100625 1.027746875 9.630925C0.992871875 9.490940625 0.9978125 9.343884375 1.04218125 9.2066125C1.086646875 9.069146875000001 1.168603125 8.947084375 1.2788468750000002 8.8539875C1.3891875 8.76079375 1.523359375 8.700440624999999 1.666153125 8.679709375L8.068525 7.753003125L10.932246875 1.9808031250000002C10.995215625 1.84915 11.09431875 1.73813125 11.217834375 1.660534375C11.341446875 1.582840625 11.484434375000001 1.5418625 11.630424999999999 1.542153125V18.63158125Z" stroke-width="0.75"></path><path stroke="#191919" stroke-linecap="round" stroke-linejoin="round" d="M10.936896875 1.971503125C11.000059375000001 1.840915625 11.098871874999999 1.73076875 11.221903125 1.6537531250000002C11.34464375 1.5767375 11.486953125 1.53585625 11.631974999999999 1.53585625C11.776996875 1.53585625 11.919209375 1.5767375 12.042046875 1.6537531250000002C12.16498125 1.73076875 12.263890625 1.840915625 12.327053125 1.971503125L15.183025 7.745253125L21.583846875000003 8.671959375C21.726737500000002 8.692690625000001 21.860812499999998 8.75304375 21.97105625 8.8462375C22.081396875000003 8.939334375 22.163353125 9.061396875 22.207721875 9.198862499999999C22.252187499999998 9.336134375 22.257128125 9.483190624999999 22.222253124999998 9.623175C22.187378125 9.763256250000001 22.113850000000003 9.890646875 22.01019375 9.99110625L17.376371875 14.4704125L18.469896875 20.803325C18.494309375 20.945149999999998 18.478615625 21.090946875 18.424462499999997 21.22434375C18.370406250000002 21.35764375 18.28011875 21.473409375 18.163771875000002 21.558175C18.047618749999998 21.642940625 17.9098625 21.693509375 17.766390625 21.7042625C17.622821875 21.714918750000002 17.479253125 21.685468750000002 17.351571875 21.618915625L11.630424999999999 18.63158125L5.89833125 21.62656875C5.770746875 21.69321875 5.62708125 21.72266875 5.4836093749999995 21.7120125C5.3401375 21.701259375 5.202478125000001 21.650690625 5.08613125 21.565925C4.96988125 21.481159375 4.87959375 21.36539375 4.8255375 21.23209375C4.77148125 21.098696874999998 4.755690625 20.9529 4.780103125 20.811075L5.873725 14.4781625L1.23980625 9.998856250000001C1.13615 9.898396875000001 1.06271875 9.77100625 1.027746875 9.630925C0.992871875 9.490940625 0.9978125 9.343884375 1.04218125 9.2066125C1.086646875 9.069146875000001 1.168603125 8.947084375 1.2788468750000002 8.8539875C1.3891875 8.76079375 1.523359375 8.700440624999999 1.666153125 8.679709375L8.068525 7.753003125L10.936896875 1.971503125Z" stroke-width="0.75"></path></svg>

            &nbsp;<a href="https://github.com/vmware-tanzu/secrets-manager" style="color:#000000;text-decoration:underline;">Star <strong>VMware Secrets Manager</strong> to show your support</a>.
            <span class="secondary-slogan">Help us reach out to even more people with this amazing tech.</span></div>

        <div class="content content--reversed">
            



<div class="documentation">
    <aside class="documentation__sidebar">
        <ul>
            
            
            <li>
                <span class="documentation__sidebar__title"></span>
                <ul>
                    
                </ul>
            </li>
            
            
            <li>
                <span class="documentation__sidebar__title">Community</span>
                <ul>
                    
                    <li class="">
                        <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;community&#x2F;hello&#x2F;">VSecM Community</a>
                    </li>
                    
                    <li class="">
                        <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;community&#x2F;contributor-hours&#x2F;">VSecM Contributor Hour</a>
                    </li>
                    
                    <li class="">
                        <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;community&#x2F;contact&#x2F;">Get in Touch</a>
                    </li>
                    
                    <li class="">
                        <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;community&#x2F;maintainers&#x2F;">Maintainers</a>
                    </li>
                    
                    <li class="">
                        <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;community&#x2F;endorsements&#x2F;">What People Say</a>
                    </li>
                    
                </ul>
            </li>
            
            
            <li>
                <span class="documentation__sidebar__title">Showcase</span>
                <ul>
                    
                    <li class="">
                        <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;showcase&#x2F;vsecm&#x2F;">VSecM Showcase</a>
                    </li>
                    
                </ul>
            </li>
            
            
            <li>
                <span class="documentation__sidebar__title">Timeline</span>
                <ul>
                    
                    <li class="">
                        <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;timeline&#x2F;roadmap&#x2F;">VSecM Roadmap</a>
                    </li>
                    
                    <li class="">
                        <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;timeline&#x2F;changelog&#x2F;">VSecM Changelog</a>
                    </li>
                    
                </ul>
            </li>
            

        
            
            <li>
                <span class="documentation__sidebar__title">Quickstart</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;getting-started&#x2F;overview&#x2F;">Prerequisites</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;getting-started&#x2F;installation&#x2F;">Installation</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;getting-started&#x2F;verify&#x2F;">Verify Installation</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;getting-started&#x2F;deploy&#x2F;">Deploy an Example Workload</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;getting-started&#x2F;register&#x2F;">Register a Secret</a>
                        </li>
                    
                </ul>
            </li>
        
            
            <li>
                <span class="documentation__sidebar__title">Welcome</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;welcome&#x2F;overview&#x2F;">Introducing VSecM</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;welcome&#x2F;about&#x2F;">What is VSecM</a>
                        </li>
                    
                </ul>
            </li>
        
            
            <li>
                <span class="documentation__sidebar__title">Architecture</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;architecture&#x2F;philosophy&#x2F;">VSecM Design Philosophy</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;architecture&#x2F;overview&#x2F;">VSecM Architecture</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;architecture&#x2F;adr-intro&#x2F;">Architectural Decision Records</a>
                        </li>
                    
                </ul>
            </li>
        
            
            <li>
                <span class="documentation__sidebar__title">Configuration</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;configuration&#x2F;overview&#x2F;">Configuring VSecM</a>
                        </li>
                    
                </ul>
            </li>
        
            
            <li>
                <span class="documentation__sidebar__title">Development</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;development&#x2F;use-the-source&#x2F;">Use the Source</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;development&#x2F;contributing&#x2F;">Contribute to VSecM</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;development&#x2F;dev-env&#x2F;">Development Environment</a>
                        </li>
                    
                </ul>
            </li>
        
            
            <li>
                <span class="documentation__sidebar__title">Using VSecM</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;usage&#x2F;installation&#x2F;">Installation</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;usage&#x2F;cli&#x2F;">VSecM CLI</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;usage&#x2F;sdk&#x2F;">VSecM SDK</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;usage&#x2F;releases&#x2F;">VSecM Releases</a>
                        </li>
                    
                </ul>
            </li>
        
            
            <li>
                <span class="documentation__sidebar__title">Use Cases</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;about&#x2F;">About Use Cases</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;overview&#x2F;">Overview</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;registering-secrets&#x2F;">Registering Secrets</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;retrieving-secrets&#x2F;">Retrieving Secrets</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;sidecar&#x2F;">Using VSecM Sidecar</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;init-container&#x2F;">Using VSecM Init Container</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;encrypt&#x2F;">Encrypting Secrets Using VSecM</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;transform&#x2F;">Transforming Secrets</a>
                        </li>
                    
                        <li class="active">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;mounting-secrets&#x2F;">Mounting Secrets as Volumes</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;template-files&#x2F;">Mutating a Template File</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;vsecm-sdk&#x2F;">Retrieving Secrets Via VSecM SDK</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;kubernetes-secrets&#x2F;">Mounting Kubernetes Secrets</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;large-files&#x2F;">Encrypting Large Files</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;root-key&#x2F;">Setting VSecM Root Key</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;use-cases&#x2F;randomized-secrets&#x2F;">Generating Randomized Secrets</a>
                        </li>
                    
                </ul>
            </li>
        
            
            <li>
                <span class="documentation__sidebar__title">Production</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;production&#x2F;overview&#x2F;">Production Setup</a>
                        </li>
                    
                </ul>
            </li>
        
            
            <li>
                <span class="documentation__sidebar__title">Operations</span>
                <ul>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;operations&#x2F;security&#x2F;">Security</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;operations&#x2F;documentation-snapshots&#x2F;">Documentation Snapshots</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;operations&#x2F;release-management&#x2F;">Release Management</a>
                        </li>
                    
                        <li class="">
                            <a href="https:&#x2F;&#x2F;vsecm.com&#x2F;documentation&#x2F;operations&#x2F;governance&#x2F;">Governance</a>
                        </li>
                    
                </ul>
            </li>
        
        </ul>
    </aside>
    <div class="documentation__content">
        
    <h1>Mounting Secrets as Volumes</h1>
    <h2 id="situation-analysis">
<a class="zola-anchor" href="#situation-analysis" aria-label="Anchor link for: situation-analysis" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>Situation Analysis</h2>
<p>Certain apps may require their secrets to be mounted in ‚Äú<em>in-memory</em>‚Äù volumes. 
Depending on the app, this could be the only way the app consumes secrets and 
configuration information.</p>
<p>When this is the only way to configure the app, especially when we don‚Äôt have 
access to the application‚Äôs configuration and source code, there won‚Äôt be any 
other feasible way to pass secrets to the app.</p>
<h2 id="screencast">
<a class="zola-anchor" href="#screencast" aria-label="Anchor link for: screencast" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>Screencast</h2>
<p>Here is a screencast that demonstrates this use case:</p>
<pre data-lang="txt" style="background-color:#2e3440;color:#d8dee9;" class="language-txt "><code class="language-txt" data-lang="txt"><span>WORK IN PROGRESS
</span></code></pre>
<h2 id="strategy">
<a class="zola-anchor" href="#strategy" aria-label="Anchor link for: strategy" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>Strategy</h2>
<p>Use <strong>VSecM Sidecar</strong> and <strong>VSecM Init Container</strong> to provide the secrets the 
workload needs when needed.</p>
<h2 id="high-level-diagram">
<a class="zola-anchor" href="#high-level-diagram" aria-label="Anchor link for: high-level-diagram" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>High-Level Diagram</h2>
<p>Open the image in a new tab to see the full-size version:</p>
<p><img src="/assets/mount-to-volume.png" alt="High-Level Diagram" title="High-Level Diagram" /></p>
<h2 id="implementation">
<a class="zola-anchor" href="#implementation" aria-label="Anchor link for: implementation" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>Implementation</h2>
<p>We will assume our workload has the name <code>example</code>, deployed to the <code>example-apps</code> 
namespace, and is associated with the <code>example-sa</code> service account, 
having a label <code>example-app</code>.</p>
<h3 id="initial-application">
<a class="zola-anchor" href="#initial-application" aria-label="Anchor link for: initial-application" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>Initial Application</h3>
<p>Here is a sample deployment manifest of such a workload:</p>
<pre data-lang="yaml" style="background-color:#2e3440;color:#d8dee9;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#8fbcbb;">apiVersion</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">apps/v1
</span><span style="color:#8fbcbb;">kind</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Deployment
</span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span>  </span><span style="color:#8fbcbb;">namespace</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-apps
</span><span>  </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">replicas</span><span style="color:#eceff4;">: </span><span style="color:#b48ead;">1
</span><span>  </span><span style="color:#8fbcbb;">selector</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">matchLabels</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>  </span><span style="color:#8fbcbb;">template</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>        </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>    </span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">serviceAccountName</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-sa
</span><span>      </span><span style="color:#8fbcbb;">containers</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-container
</span><span>        </span><span style="color:#8fbcbb;">image</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app:0.1.0
</span></code></pre>
<h3 id="create-a-clusterspiffeid">
<a class="zola-anchor" href="#create-a-clusterspiffeid" aria-label="Anchor link for: create-a-clusterspiffeid" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>Create a <code>ClusterSPIFFEID</code></h3>
<p>For <strong>VSecM</strong> to communicate with this workload, a <code>ClusterSPIFFEID</code> is needed.</p>
<p>Here is how such a ClusterSPIFFEID may look like:</p>
<pre data-lang="yaml" style="background-color:#2e3440;color:#d8dee9;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#8fbcbb;">apiVersion</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">spire.spiffe.io/v1alpha1
</span><span style="color:#8fbcbb;">kind</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">ClusterSPIFFEID
</span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">className</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">vsecm
</span><span>  </span><span style="color:#8fbcbb;">spiffeIDTemplate</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;spiffe://vsecm.com</span><span style="color:#ebcb8b;">\
</span><span style="color:#a3be8c;">    /workload/example</span><span style="color:#ebcb8b;">\
</span><span style="color:#a3be8c;">    /ns/{{ .PodMeta.Namespace }}</span><span style="color:#ebcb8b;">\
</span><span style="color:#a3be8c;">    /sa/{{ .PodSpec.ServiceAccountName }}</span><span style="color:#ebcb8b;">\
</span><span style="color:#a3be8c;">    /n/{{ .PodMeta.Name }}&quot;
</span><span>  </span><span style="color:#8fbcbb;">podSelector</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">matchLabels</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>  </span><span style="color:#8fbcbb;">workloadSelectorTemplates</span><span style="color:#eceff4;">:
</span><span>    - </span><span style="color:#a3be8c;">&quot;k8s:ns:example-apps&quot;
</span><span>    - </span><span style="color:#a3be8c;">&quot;k8s:sa:example-sa&quot;
</span></code></pre>
<p>When this <code>ClusterSPIFFEID</code> is defined, our example pod will get a secure 
x.509 certificate from the <a href="https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE_Workload_API.md" title="SPIFFE Workload API">SPIFFE Workload API</a> to talk to VSecM; 
however, to fetch the certificate, we will need to modify the pod‚Äôs deployment 
manifest slightly. </p>
<p>Let‚Äôs see that in the next section.</p>
<h3 id="let-the-workload-consume-spiffe-workload-api">
<a class="zola-anchor" href="#let-the-workload-consume-spiffe-workload-api" aria-label="Anchor link for: let-the-workload-consume-spiffe-workload-api" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>Let the Workload Consume SPIFFE Workload API</h3>
<p>Here is the modified deployment manifest to consume SPIFFE Workload API:</p>
<pre data-lang="yaml" style="background-color:#2e3440;color:#d8dee9;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#8fbcbb;">apiVersion</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">apps/v1
</span><span style="color:#8fbcbb;">kind</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Deployment
</span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span>  </span><span style="color:#8fbcbb;">namespace</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-apps
</span><span>  </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">replicas</span><span style="color:#eceff4;">: </span><span style="color:#b48ead;">1
</span><span>  </span><span style="color:#8fbcbb;">selector</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">matchLabels</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>  </span><span style="color:#8fbcbb;">template</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>        </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>    </span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">serviceAccountName</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-sa
</span><span>      </span><span style="color:#8fbcbb;">containers</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-container
</span><span>        </span><span style="color:#8fbcbb;">image</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app:0.1.0
</span><span>
</span><span style="color:#616e88;">## &lt;--- BEGIN CHANGE
</span><span>      </span><span style="color:#8fbcbb;">volumes</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">spire-agent-socket
</span><span>          </span><span style="color:#8fbcbb;">csi</span><span style="color:#eceff4;">:
</span><span>            </span><span style="color:#8fbcbb;">driver</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;csi.spiffe.io&quot;
</span><span>            </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span style="color:#616e88;">## &lt;-- END CHANGE
</span></code></pre>
<p>We added a special volume, and the [SPIFFE CSI Driver][spiffe-csi-drive] 
will handle the rest of the communication.</p>
<p>Here is the manifest without the change markers:</p>
<pre data-lang="yaml" style="background-color:#2e3440;color:#d8dee9;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#8fbcbb;">apiVersion</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">apps/v1
</span><span style="color:#8fbcbb;">kind</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Deployment
</span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span>  </span><span style="color:#8fbcbb;">namespace</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-apps
</span><span>  </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">replicas</span><span style="color:#eceff4;">: </span><span style="color:#b48ead;">1
</span><span>  </span><span style="color:#8fbcbb;">selector</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">matchLabels</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>  </span><span style="color:#8fbcbb;">template</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>        </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>    </span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">serviceAccountName</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-sa
</span><span>      </span><span style="color:#8fbcbb;">containers</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-container
</span><span>        </span><span style="color:#8fbcbb;">image</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app:0.1.0
</span><span>      </span><span style="color:#8fbcbb;">volumes</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">spire-agent-socket
</span><span>          </span><span style="color:#8fbcbb;">csi</span><span style="color:#eceff4;">:
</span><span>            </span><span style="color:#8fbcbb;">driver</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;csi.spiffe.io&quot;
</span><span>            </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span></code></pre>
<p>Let‚Äôs say this workload needs an <code>/opt/app/credentials</code> file as an initial 
configuration file to execute its business logic. Based on this assumption, 
let‚Äôs update the manifest accordingly to provide this file:</p>
<pre data-lang="yaml" style="background-color:#2e3440;color:#d8dee9;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#8fbcbb;">apiVersion</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">apps/v1
</span><span style="color:#8fbcbb;">kind</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Deployment
</span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span>  </span><span style="color:#8fbcbb;">namespace</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-apps
</span><span>  </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">replicas</span><span style="color:#eceff4;">: </span><span style="color:#b48ead;">1
</span><span>  </span><span style="color:#8fbcbb;">selector</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">matchLabels</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>  </span><span style="color:#8fbcbb;">template</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>        </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>    </span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">serviceAccountName</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-sa
</span><span>      </span><span style="color:#8fbcbb;">containers</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-container
</span><span>        </span><span style="color:#8fbcbb;">image</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app:0.1.0
</span><span>
</span><span style="color:#616e88;">## &lt;--- BEGIN CHANGE
</span><span>        </span><span style="color:#8fbcbb;">volumeMounts</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>          </span><span style="color:#8fbcbb;">mountPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">/opt/app/credentials
</span><span>          </span><span style="color:#8fbcbb;">subPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span style="color:#616e88;">## &lt;--- END CHANGE
</span><span>
</span><span>      </span><span style="color:#8fbcbb;">volumes</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">spire-agent-socket
</span><span>        </span><span style="color:#8fbcbb;">csi</span><span style="color:#eceff4;">:
</span><span>          </span><span style="color:#8fbcbb;">driver</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;csi.spiffe.io&quot;
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>
</span><span style="color:#616e88;">## &lt;--- BEGIN CHANGE
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>        </span><span style="color:#8fbcbb;">emptyDir</span><span style="color:#eceff4;">:
</span><span>          </span><span style="color:#8fbcbb;">medium</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Memory
</span><span style="color:#616e88;">## &lt;--- END CHANGE
</span></code></pre>
<p>However, the volume is <em>empty</em>; our app will likely require it to be populated 
before it can be used. We will address this real soon.</p>
<p>Here‚Äôs the manifest without the change markers:</p>
<pre data-lang="yaml" style="background-color:#2e3440;color:#d8dee9;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#8fbcbb;">apiVersion</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">apps/v1
</span><span style="color:#8fbcbb;">kind</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Deployment
</span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span>  </span><span style="color:#8fbcbb;">namespace</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-apps
</span><span>  </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">replicas</span><span style="color:#eceff4;">: </span><span style="color:#b48ead;">1
</span><span>  </span><span style="color:#8fbcbb;">selector</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">matchLabels</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>  </span><span style="color:#8fbcbb;">template</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>        </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>    </span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">serviceAccountName</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-sa
</span><span>      </span><span style="color:#8fbcbb;">containers</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-container
</span><span>        </span><span style="color:#8fbcbb;">image</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app:0.1.0
</span><span>        </span><span style="color:#8fbcbb;">volumeMounts</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>          </span><span style="color:#8fbcbb;">mountPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">/opt/app/credentials
</span><span>          </span><span style="color:#8fbcbb;">subPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>      </span><span style="color:#8fbcbb;">volumes</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">spire-agent-socket
</span><span>        </span><span style="color:#8fbcbb;">csi</span><span style="color:#eceff4;">:
</span><span>          </span><span style="color:#8fbcbb;">driver</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;csi.spiffe.io&quot;
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>        </span><span style="color:#8fbcbb;">emptyDir</span><span style="color:#eceff4;">:
</span><span>          </span><span style="color:#8fbcbb;">medium</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Memory
</span></code></pre>
<p>We will populate the volume using <strong>VSecM Sidecar</strong>.</p>
<h3 id="initializing-the-volume-using-vsecm-sidecar">
<a class="zola-anchor" href="#initializing-the-volume-using-vsecm-sidecar" aria-label="Anchor link for: initializing-the-volume-using-vsecm-sidecar" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>Initializing the Volume Using VSecM Sidecar</h3>
<p>Let‚Äôs add <strong>VSecM Sidecar</strong> to our manifest:</p>
<pre data-lang="yaml" style="background-color:#2e3440;color:#d8dee9;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#8fbcbb;">apiVersion</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">apps/v1
</span><span style="color:#8fbcbb;">kind</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Deployment
</span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span>  </span><span style="color:#8fbcbb;">namespace</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-apps
</span><span>  </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">replicas</span><span style="color:#eceff4;">: </span><span style="color:#b48ead;">1
</span><span>  </span><span style="color:#8fbcbb;">selector</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">matchLabels</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>  </span><span style="color:#8fbcbb;">template</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>        </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>    </span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">serviceAccountName</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-sa
</span><span>      </span><span style="color:#8fbcbb;">containers</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-container
</span><span>        </span><span style="color:#8fbcbb;">image</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app:0.1.0
</span><span>        </span><span style="color:#8fbcbb;">volumeMounts</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>          </span><span style="color:#8fbcbb;">mountPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">/opt/app/credentials
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>
</span><span style="color:#616e88;">## &lt;--- BEGIN CHANGE
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">sidecar
</span><span>        </span><span style="color:#8fbcbb;">image</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">vsecm/vsecm-ist-sidecar:0.24.1
</span><span>        </span><span style="color:#8fbcbb;">volumeMounts</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">mountPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">/opt/app/credentials
</span><span>          </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">spire-agent-socket
</span><span>          </span><span style="color:#8fbcbb;">mountPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">/spire-agent-socket
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>        </span><span style="color:#8fbcbb;">env</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">VSECM_SIDECAR_SECRET_PATH
</span><span>          </span><span style="color:#8fbcbb;">value</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;/opt/app/credentials/secrets.json&quot;  
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">SPIFFE_ENDPOINT_SOCKET
</span><span>          </span><span style="color:#8fbcbb;">value</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;unix:///spire-agent-socket/spire-agent.sock&quot;
</span><span style="color:#616e88;">## &lt;--- END CHANGE
</span><span>
</span><span>      </span><span style="color:#8fbcbb;">volumes</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">spire-agent-socket
</span><span>        </span><span style="color:#8fbcbb;">csi</span><span style="color:#eceff4;">:
</span><span>          </span><span style="color:#8fbcbb;">driver</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;csi.spiffe.io&quot;
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>        </span><span style="color:#8fbcbb;">emptyDir</span><span style="color:#eceff4;">:
</span><span>          </span><span style="color:#8fbcbb;">medium</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Memory
</span></code></pre>
<p>In this setup, <strong>VSecM Sidecar</strong> will periodically poll <strong>VSecM Safe</strong> to fetch 
the secret associated with the workload and update <code>/opt/app/credentials</code>.</p>
<blockquote>
<p><strong>Help Needed</strong></p>
<p><strong>VSecM Sidecar</strong> currently creates a single file. If the application needs 
more than one file in the volume, you‚Äôll need to create a specialized sidecar 
based on VSecM Sidecar.</p>
<p>There are upstream issues that will enable <strong>VSecM Sidecar</strong> to parse the 
incoming secret and create separate files in its associated volume. </p>
<p>If you need this functionality, you are welcome to contribute upstream.</p>
<ul>
<li><a href="https://github.com/vmware-tanzu/secrets-manager/issues/759">VSecM Init Container should be (optionally cofigurable) able to watch the 
changes in a volume or a file instead of VSecM Safe <code>#759</code></a></li>
<li><a href="https://github.com/vmware-tanzu/secrets-manager/issues/761">VSecM Sidecar should be able to (optionally) create one file per 
secret key <code>#761</code></a></li>
</ul>
</blockquote>
<p>Here‚Äôs the YAML manifest without change markers:</p>
<pre data-lang="yaml" style="background-color:#2e3440;color:#d8dee9;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#8fbcbb;">apiVersion</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">apps/v1
</span><span style="color:#8fbcbb;">kind</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Deployment
</span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span>  </span><span style="color:#8fbcbb;">namespace</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-apps
</span><span>  </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">replicas</span><span style="color:#eceff4;">: </span><span style="color:#b48ead;">1
</span><span>  </span><span style="color:#8fbcbb;">selector</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">matchLabels</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>  </span><span style="color:#8fbcbb;">template</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>        </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>    </span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">serviceAccountName</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-sa
</span><span>      </span><span style="color:#8fbcbb;">containers</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-container
</span><span>        </span><span style="color:#8fbcbb;">image</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app:0.1.0
</span><span>        </span><span style="color:#8fbcbb;">volumeMounts</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>          </span><span style="color:#8fbcbb;">mountPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">/opt/app/credentials
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">sidecar
</span><span>        </span><span style="color:#8fbcbb;">image</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">vsecm/vsecm-ist-sidecar:0.24.1
</span><span>        </span><span style="color:#8fbcbb;">volumeMounts</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">mountPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">/opt/app/credentials
</span><span>          </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">spire-agent-socket
</span><span>          </span><span style="color:#8fbcbb;">mountPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">/spire-agent-socket
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>        </span><span style="color:#8fbcbb;">env</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">VSECM_SIDECAR_SECRET_PATH
</span><span>          </span><span style="color:#8fbcbb;">value</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;/opt/app/credentials/secrets.json&quot;  
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">SPIFFE_ENDPOINT_SOCKET
</span><span>          </span><span style="color:#8fbcbb;">value</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;unix:///spire-agent-socket/spire-agent.sock&quot;
</span><span>      </span><span style="color:#8fbcbb;">volumes</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">spire-agent-socket
</span><span>        </span><span style="color:#8fbcbb;">csi</span><span style="color:#eceff4;">:
</span><span>          </span><span style="color:#8fbcbb;">driver</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;csi.spiffe.io&quot;
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>        </span><span style="color:#8fbcbb;">emptyDir</span><span style="color:#eceff4;">:
</span><span>          </span><span style="color:#8fbcbb;">medium</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Memory
</span></code></pre>
<p>But now, we have another problem: The main application likely assumes the 
credentials are already there when it starts its lifecycle. The app will likely 
crash if the credentials are not there during its bootstrapping.</p>
<p>To fix this, we‚Äôll need an init container that watches this volume and initializes 
the main app only after it is populated. We will implement this in the following 
section.</p>
<h3 id="adding-an-init-container-to-wait-for-the-volume-to-populate">
<a class="zola-anchor" href="#adding-an-init-container-to-wait-for-the-volume-to-populate" aria-label="Anchor link for: adding-an-init-container-to-wait-for-the-volume-to-populate" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>Adding an Init Container to Wait for The Volume to Populate</h3>
<p>Let‚Äôs add an init container to complete our plan:</p>
<pre data-lang="yaml" style="background-color:#2e3440;color:#d8dee9;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#8fbcbb;">apiVersion</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">apps/v1
</span><span style="color:#8fbcbb;">kind</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Deployment
</span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span>  </span><span style="color:#8fbcbb;">namespace</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-apps
</span><span>  </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example
</span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">replicas</span><span style="color:#eceff4;">: </span><span style="color:#b48ead;">1
</span><span>  </span><span style="color:#8fbcbb;">selector</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">matchLabels</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>  </span><span style="color:#8fbcbb;">template</span><span style="color:#eceff4;">:
</span><span>    </span><span style="color:#8fbcbb;">metadata</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">labels</span><span style="color:#eceff4;">:
</span><span>        </span><span style="color:#8fbcbb;">app</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app
</span><span>    </span><span style="color:#8fbcbb;">spec</span><span style="color:#eceff4;">:
</span><span>      </span><span style="color:#8fbcbb;">serviceAccountName</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-sa
</span><span>
</span><span style="color:#616e88;">## &lt;--- BEGIN CHANGE
</span><span>      </span><span style="color:#8fbcbb;">initContainers</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">vsecm-init-container
</span><span>        </span><span style="color:#8fbcbb;">image</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">vsecm/vsecm-ist-init-container:latest
</span><span>        </span><span style="color:#8fbcbb;">volumeMounts</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>          </span><span style="color:#8fbcbb;">mountPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">/opt/vsecm/secrets
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span style="color:#616e88;">## &lt;--- END CHANGE
</span><span>
</span><span>      </span><span style="color:#8fbcbb;">containers</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-container
</span><span>        </span><span style="color:#8fbcbb;">image</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">example-app:0.1.0
</span><span>        </span><span style="color:#8fbcbb;">volumeMounts</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>          </span><span style="color:#8fbcbb;">mountPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">/opt/app/credentials
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">sidecar
</span><span>        </span><span style="color:#8fbcbb;">image</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">vsecm/vsecm-ist-sidecar:0.24.1
</span><span>        </span><span style="color:#8fbcbb;">volumeMounts</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">mountPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">/opt/app/credentials
</span><span>          </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">spire-agent-socket
</span><span>          </span><span style="color:#8fbcbb;">mountPath</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">/spire-agent-socket
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>        </span><span style="color:#8fbcbb;">env</span><span style="color:#eceff4;">:
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">VSECM_SIDECAR_SECRET_PATH
</span><span>          </span><span style="color:#8fbcbb;">value</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;/opt/app/credentials/secrets.json&quot;  
</span><span>        - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">SPIFFE_ENDPOINT_SOCKET
</span><span>          </span><span style="color:#8fbcbb;">value</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;unix:///spire-agent-socket/spire-agent.sock&quot;
</span><span>      </span><span style="color:#8fbcbb;">volumes</span><span style="color:#eceff4;">:
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">spire-agent-socket
</span><span>        </span><span style="color:#8fbcbb;">csi</span><span style="color:#eceff4;">:
</span><span>          </span><span style="color:#8fbcbb;">driver</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&quot;csi.spiffe.io&quot;
</span><span>          </span><span style="color:#8fbcbb;">readOnly</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>      - </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">credentials-volume
</span><span>        </span><span style="color:#8fbcbb;">emptyDir</span><span style="color:#eceff4;">:
</span><span>          </span><span style="color:#8fbcbb;">medium</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">Memory
</span></code></pre>
<p><strong>VSecM Init Container</strong> will now watch the volume and only initialize the main 
app when everything is ready.</p>
<blockquote>
<p><strong>Help Needed</strong></p>
<p>Enhancing the VSecM Init Container to monitor volume changes is an outstanding 
upstream issue. Your contributions are welcome.</p>
<ul>
<li><a href="https://github.com/vmware-tanzu/secrets-manager/issues/759">VSecM Init Container should be (optionally configurable) able to watch the 
changes in a volume or a file instead of VSecM Safe <code>#759</code></a></li>
</ul>
<p>Until this issue is resolved, you might need to add a second init container to 
introduce some delay (<em>~10-15 seconds, on average</em>) for <strong>VSecM Sidecar</strong> to 
consume the secret and create the file needed.</p>
</blockquote>
<h3 id="providing-randomized-secrets-to-the-workload">
<a class="zola-anchor" href="#providing-randomized-secrets-to-the-workload" aria-label="Anchor link for: providing-randomized-secrets-to-the-workload" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>Providing Randomized Secrets to the Workload</h3>
<p>VSecM Helm Charts can be configured to provide secure pattern-based random secrets 
for workloads. For example, we can modify <a href="https://github.com/vmware-tanzu/secrets-manager/commit/cbd3b33d9f50569d7b14034a7551ccc6d6575ed7#diff-f4d0a065a7104f6d7271039d0c61dd6ff5155e7a86ca98570c49ecbd48947122R91-R120">the initCommand stanza</a> 
of the sentinel Helm chart‚Äôs <code>values.yaml</code> to register a random username and 
password as secrets for our example workload.</p>
<pre data-lang="yaml" style="background-color:#2e3440;color:#d8dee9;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#616e88;"># ./charts/sentinel/values.yaml
</span><span>
</span><span style="color:#8fbcbb;">initCommand</span><span style="color:#eceff4;">:
</span><span>  </span><span style="color:#8fbcbb;">enabled</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">true
</span><span>  </span><span style="color:#8fbcbb;">command</span><span style="color:#eceff4;">: </span><span style="color:#81a1c1;">|
</span><span style="color:#a3be8c;">    --
</span><span style="color:#a3be8c;">    w:example
</span><span style="color:#a3be8c;">    n:example-apps
</span><span style="color:#a3be8c;">    s:gen:{&quot;username&quot;:&quot;admin-[a-z0-9]{6}&quot;,&quot;password&quot;:&quot;[a-zA-Z0-9]{12}&quot;}
</span><span style="color:#a3be8c;">    t:{&quot;ADMIN_USER&quot;:&quot;{{.username}}&quot;,&quot;ADMIN_PASS&quot;:&quot;{{.password}}&quot;}
</span><span style="color:#a3be8c;">    --
</span></code></pre>
<h2 id="conclusion">
<a class="zola-anchor" href="#conclusion" aria-label="Anchor link for: conclusion" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>Conclusion</h2>
<p>Integrating <strong>VSecM Sidecar</strong> and <strong>VSecM Init Container</strong> for secret management 
represents a forward-thinking solution to the challenge of securely providing 
secrets to Kubernetes workloads. </p>
<p>This approach embodies the principles of zero trust security by ensuring that 
secrets are dynamically managed and securely injected, thereby minimizing the 
risk of exposure. As Kubernetes continues to evolve, such patterns will be 
pivotal in addressing the complex security needs of cloud-native applications, 
making contributions and enhancements in this space invaluable.</p>
<p>Here are some key points covered in this use case:</p>
<ul>
<li><strong>Strategy and Implementation</strong>: The approach involves using a sidecar and 
init container pattern to inject secrets securely into a Kubernetes pod.d. The 
example provided demonstrates how to deploy a workload with this pattern, 
highlighting the importance of security in modern cloud-native applications.</li>
<li><strong>Secure Secret Management</strong>: By leveraging <a href="https://github.com/spiffe/spire-controller-manager/blob/main/docs/clusterspiffeid-crd.md"><code>ClusterSPIFFEID</code>s</a> 
and the <a href="https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE_Workload_API.md">SPIFFE Workload API</a>, the system ensures secure 
communication between the workload and <strong>VSecM</strong>. This method enhances security 
by providing each pod with a unique identity and secure certificates for 
authentication.</li>
<li><strong>Dynamic Secret Injection</strong>: Introducing a sidecar container allows for dynamic 
secret fetching and updating, ensuring that workloads can access the most current 
secrets without restarting pods. This approach mainly benefits applications 
requiring high security and frequent secret rotations.</li>
<li><strong>Initialization and Secret Readiness</strong>: An init container ensures that the 
main application starts only after the secrets are properly fetched and mounted, 
addressing the challenge of secret readiness at application startup. This is 
critical for applications that expect specific configurations to be present 
before initialization.</li>
<li><strong>Customization and Contribution</strong>: The article also suggests customizing the 
sidecar for applications needing multiple secrets in separate files and invites 
contributions to enhance the <strong>VSecM Sidecar</strong>‚Äôs functionality.</li>
</ul>
<h2 id="list-of-use-cases-in-this-section">
<a class="zola-anchor" href="#list-of-use-cases-in-this-section" aria-label="Anchor link for: list-of-use-cases-in-this-section" style="position:relative; top: -4px;">
  <img src="https://vsecm.com/vsecm-32.png" alt="Link" style="vertical-align:middle">
</a>List of Use Cases in This Section</h2>
<!--
# /*
# |    Protect your secrets, protect your sensitive data.
# :    Explore VMware Secrets Manager docs at https://vsecm.com/
# </
# <>/  keep your secrets... secret
# >/
# <>/' Copyright 2023-present VMware Secrets Manager contributors.
# >/'  SPDX-License-Identifier: BSD-2-Clause
# */
-->
<ul>
<li><a href="https://vsecm.com/documentation/use-cases/overview/">Overview of Use Cases</a></li>
<li><a href="https://vsecm.com/documentation/use-cases/registering-secrets/">Registering Secrets</a></li>
<li><a href="https://vsecm.com/documentation/use-cases/retrieving-secrets/">Retrieving Secrets</a></li>
<li><a href="https://vsecm.com/documentation/use-cases/sidecar/">Using <strong>VSecM Sidecar</strong></a></li>
<li><a href="https://vsecm.com/documentation/use-cases/vsecm-sdk/">Using <strong>VSecM SDK</strong></a></li>
<li><a href="https://vsecm.com/documentation/use-cases/init-container/">Using <strong>VSecM Init Container</strong></a></li>
<li><a href="https://vsecm.com/documentation/use-cases/encrypt/">Encrypting Secrets</a></li>
<li><a href="https://vsecm.com/documentation/use-cases/transform/">Transforming Secrets</a></li>
<li><a href="https://vsecm.com/documentation/use-cases/mounting-secrets/">Mounting Secrets as Volumes</a></li>
<li><a href="https://vsecm.com/documentation/use-cases/template-files/">Mutating a Template File</a></li>
<li><a href="https://vsecm.com/documentation/use-cases/large-files/">Encrypting Large Files</a></li>
<li><a href="https://vsecm.com/documentation/use-cases/root-key/">Setting the Root Keys Externally</a></li>
<li><a href="https://vsecm.com/documentation/use-cases/randomized-secrets/">Generating Pattern-Based Randomized Secrets</a></li>
<li><a href="https://vsecm.com/showcase/vsecm/"><strong>VMware Secrets Manager</strong> Showcase</a></li>
</ul>
<!--
# /*
# |    Protect your secrets, protect your sensitive data.
# :    Explore VMware Secrets Manager docs at https://vsecm.com/
# </
# <>/  keep your secrets... secret
# >/
# <>/' Copyright 2023-present VMware Secrets Manager contributors.
# >/'  SPDX-License-Identifier: BSD-2-Clause
# */
-->
<p class="github-button" style="text-align: right;margin-top:2em;border-top:1px #ccc dashed;padding-top:2em;">
  <a href="https://github.com/vmware-tanzu/secrets-manager/blob/main/docs/">
    edit this page ‚úèÔ∏è 
  </a>
</p>


    </div>
</div>

        </div>
        <footer style="background:#00151D;">
            Copyright ¬© 2023-present <a style="color:#95e2fc" href="https://github.com/vmware-tanzu/secrets-manager/graphs/contributors">VMware Secrets Manager contributors</a>.<br><br>
            <strong>VMware Secrets Manager</strong> for Cloud-Native Apps<br>
            code is distributed under <a style="color:#95e2fc"  href="https://github.com/vmware-tanzu/secrets-manager/blob/main/LICENSE">BSD 2-Clause License</a>.<br>
            <br>
            The documentation on this website<br>
            is distributed under <a style="color:#95e2fc"  href="https://creativecommons.org/licenses/by/4.0/">CC-BY-4.0</a>.
            <br><br>
            <a style="color:#95e2fc" href="/community/contact/">contact</a> |
            <a style="color:#95e2fc" href="/privacy/">privacy policy</a> |
            <a style="color:#95e2fc" href="/code-of-conduct">code of conduct</a>
            <br><br>
        </footer>

        <script type="text/javascript" src="https://vsecm.com/elasticlunr.min.js"></script>
        <script type="text/javascript" src="https://vsecm.com/search.js"></script>
    </body>
</html>
